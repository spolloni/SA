 -- AREA
 select avg(sqkm) from
(select st_area(GEOMETRY)/1000000 as sqkm , rdp from projects
where st_area(GEOMETRY)/1000000 < 100
and cluster in 
(1002, 1008, 1016, 1046, 1054, 1055, 1060, 1069, 
 1092, 1093, 1096, 1100, 1102, 1107, 1108, 1110, 
 1115, 1117, 1122, 1128, 1135, 1151, 1162, 1166, 
 1180, 1189, 1195, 1200, 1201, 1206, 1236, 1239, 
 1241, 1243, 1247, 1269, 1280, 1282, 1288, 1292, 
 1308, 1309, 1311, 1313, 1314, 1325, 1328, 1330, 
 1341, 1344, 1346, 1347, 1352, 1362, 1364, 1374, 
 1379, 1384, 1385, 1388, 1007, 1032, 1033, 1034, 
 1040, 1042, 1043, 1049, 1050, 1057, 1058, 1062, 
 1063, 1064, 1065, 1067, 1076, 1079, 1082, 1091, 
 1111, 1114, 1123, 1124, 1125, 1126, 1127, 1132, 
 1139, 1145, 1152, 1167, 1211, 1278, 1290, 1298, 
 1299, 1300, 1303, 1304, 1305, 1307, 1310, 1323, 
 1331, 1349, 1353, 1354, 1356, 1357, 1358, 1361, 
 1363, 1376, 1377, 1383, 1386)
) as area
group by rdp 

-- RDP HOUSES PER PROJECT
select count(property_id) as count,  betterberdp from
(
	select rdp.property_id, rdp.rdp_all, rdp.rdp_notownship, projects.cluster, projects.rdp as betterberdp  from rdp
	join erven on rdp.property_id = erven.property_id
	join projects on st_intersects(projects.GEOMETRY, erven.GEOMETRY)
	where rdp_all =1
)
where betterberdp =1
and cluster in 
(1002, 1008, 1016, 1046, 1054, 1055, 1060, 1069, 
 1092, 1093, 1096, 1100, 1102, 1107, 1108, 1110, 
 1115, 1117, 1122, 1128, 1135, 1151, 1162, 1166, 
 1180, 1189, 1195, 1200, 1201, 1206, 1236, 1239, 
 1241, 1243, 1247, 1269, 1280, 1282, 1288, 1292, 
 1308, 1309, 1311, 1313, 1314, 1325, 1328, 1330, 
 1341, 1344, 1346, 1347, 1352, 1362, 1364, 1374, 
 1379, 1384, 1385, 1388, 1007, 1032, 1033, 1034, 
 1040, 1042, 1043, 1049, 1050, 1057, 1058, 1062, 
 1063, 1064, 1065, 1067, 1076, 1079, 1082, 1091, 
 1111, 1114, 1123, 1124, 1125, 1126, 1127, 1132, 
 1139, 1145, 1152, 1167, 1211, 1278, 1290, 1298, 
 1299, 1300, 1303, 1304, 1305, 1307, 1310, 1323, 
 1331, 1349, 1353, 1354, 1356, 1357, 1358, 1361, 
 1363, 1376, 1377, 1383, 1386)
GROUP BY cluster


-- DISTANCE TO CBD
select avg(distance), rdp from 
(
	select 
		projects.GEOMETRY, 
		projects.cluster, 
		projects.rdp, 
		cbd_centroids_stef.town,
		st_distance(st_centroid(projects.GEOMETRY),st_centroid(cbd_centroids_stef.GEOMETRY))/1000 as distance
	from projects
	cross join  cbd_centroids_stef	
	where projects.cluster in 
(1002, 1008, 1016, 1046, 1054, 1055, 1060, 1069, 
 1092, 1093, 1096, 1100, 1102, 1107, 1108, 1110, 
 1115, 1117, 1122, 1128, 1135, 1151, 1162, 1166, 
 1180, 1189, 1195, 1200, 1201, 1206, 1236, 1239, 
 1241, 1243, 1247, 1269, 1280, 1282, 1288, 1292, 
 1308, 1309, 1311, 1313, 1314, 1325, 1328, 1330, 
 1341, 1344, 1346, 1347, 1352, 1362, 1364, 1374, 
 1379, 1384, 1385, 1388, 1007, 1032, 1033, 1034, 
 1040, 1042, 1043, 1049, 1050, 1057, 1058, 1062, 
 1063, 1064, 1065, 1067, 1076, 1079, 1082, 1091, 
 1111, 1114, 1123, 1124, 1125, 1126, 1127, 1132, 
 1139, 1145, 1152, 1167, 1211, 1278, 1290, 1298, 
 1299, 1300, 1303, 1304, 1305, 1307, 1310, 1323, 
 1331, 1349, 1353, 1354, 1356, 1357, 1358, 1361, 
 1363, 1376, 1377, 1383, 1386)
	GROUP BY cluster
	having distance = min(distance)
)  as distances
GROUP BY rdp




 


